\documentclass{amsart}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{times}
\usepackage{xypic}

\newcommand{\NN}{\mathbb{N}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\ZZ}{\mathbb{Z}}

\newcommand{\all}[1]{\forall #1 \,.\,}
\newcommand{\some}[1]{\exists #1 \,.\,}
\newcommand{\set}[1]{\{#1\}}
\newcommand{\such}{\mid}

\newcommand{\op}{\mathsf{op}}
\newcommand{\one}{\mathsf{1}}

\newcommand{\Cinfty}{\mathcal{C}^\infty}

\newcommand{\sem}[1]{[\![#1]\!]}

{\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{example}[definition]{Example}
}

\begin{document}

\title{What is algebraic about algebraic effects?}

\author{Andrej Bauer}

\begin{abstract}
  This is a short tutorial on algebraic theories and their relation to computational
  effects, as known in the theory of programming languages. An unusually large number of
  examples is provided, and excursions into category theory are kept to a minimum.
\end{abstract}

\maketitle

\section{Algebraic theories}
\label{sec:algebraic-theories}


\subsection{Signatures, terms and equations}
\label{sec:signatures-equations}

In algebra we study mathematical structures that are equipped with operations satisfying
equational laws. For example, a group is a structure $(G, \mathsf{u}, {\cdot}, {}^{-1})$,
where $\mathsf{u}$~is a constant, $\cdot$~is a binary operation, and ${}^{-1}$~is a unary
operation, satisfying the familiar group identities:
%
\begin{gather*}
  (x \cdot y) \cdot z = x \cdot (y \cdot z),\\
  \mathsf{u} \cdot x = x = x \cdot \mathsf{u},\\
  x \cdot x^{-1} = \mathsf{u} = x^{-1} \cdot x.
\end{gather*}
%
There are alternative axiomatizations of groups. For example, a group is a monoid
$(G, \mathsf{u}, {\cdot})$ in which every element is invertible, i.e., for every $x$ there
exists $y$ such that $x \cdot y = \mathsf{u} = y \cdot x$. However, we prefer the
formulation in which the axioms are just equations between terms built from variables and
operations (a constant is construed as a nullary operation). Such theories are known as
\emph{algebraic} or \emph{equational theories}.

A \emph{signature $\Sigma$} is a collection of \emph{operation symbols}
$\op_1, \op_2, \op_3, \ldots$, each of which has an associated \emph{arity} $n_i \in \NN$.
An operation symbol whose arity is~$0$ is called a \emph{constant} or a \emph{nullary}
symbol. Operation symbols with arities $1$, $2$ and $3$ are referred to as \emph{unary},
\emph{binary}, and \emph{ternary}, respectively.

A list of distinct variables $x_1, \ldots, x_k$ is called a \emph{context}. The
\emph{$\Sigma$-terms in context $x_1, \ldots, x_k$} are built inductively using the
following rules:
% 
\begin{enumerate}
\item each variable $x_i$ is a $\Sigma$-term in context $x_1, \ldots, x_k$,
\item if $t_1, \ldots, t_{n_i}$ are $\Sigma$-terms in context $x_1, \ldots, x_k$ then
  $\op_i(t_1, \ldots, t_{n_i})$ is a $\Sigma$-term in context $x_1, \ldots, x_k$.
\end{enumerate}
%
We write
%
\begin{equation*}
  x_1, \ldots, x_k \mid t
\end{equation*}
%
to indicate that $t$ is a $\Sigma$-term in the given context. A \emph{closed
  $\Sigma$-term} is a $\Sigma$-term in the empty context, so that no variables appear
in~$t$.

A \emph{$\Sigma$-equation} in context $x_1, \ldots, x_k$ is a pair of $\Sigma$-terms
$\ell$ and $r$ in context $x_1, \ldots, x_k$. We write
%
\begin{equation*}
  x_1, \ldots, x_k \mid \ell = r
\end{equation*}
%
to indicate an equation in a context. We shall often elide the context and write simply
$\ell = r$, but it should be understood that there is an ambient context which contains at
least all the variables mentioned by $\ell$ and $r$. When no confusion can arise we also
drop the prefix ``$\Sigma$-'' and speak of just terms and equations instead of
$\Sigma$-terms and $\Sigma$-equations.

It is best to think of $\Sigma$-terms not as syntactic expressions, but as finite trees
whose leaves are variables and whose nodes are labeled with operation symbols. The node
labeled with $\op_i$ has $n_i$ subtrees. Similarly, equations should be viewed as data
that the algebraic theory incoporates, rather than logical statements, i.e., $\ell = r$ is
just a suggestive way of displaying the two terms $\ell$ and $r$.

\begin{example}
  \label{ex:monoid-signature}
  %
  The signature for the theory of a monoid has a nullary symbol $\mathsf{u}$ and a binary
  symbol $\mathsf{m}$. There are infinitely many expressions in context $x, y$, such as
  %
  \begin{align*}
    \mathsf{u}(),\quad
    x,\quad
    y,\quad
    \mathsf{m}(\mathsf{u}(), \mathsf{u}()),\quad
    \mathsf{m}(\mathsf{u}(), x),\quad
    \mathsf{m}(y, \mathsf{u}()),\quad
    \mathsf{m}(x, x),\quad
    \mathsf{m}(y, x),
    \ldots
  \end{align*}
  %
  An equation in context $x, y$ is
  %
  \begin{equation*}
    x, y \mid \mathsf{m}(y, x) = \mathsf{m}(\mathsf{m}(\mathsf{u}(), x), y).
  \end{equation*}
  %
  It is customary to write a nullary symbol $\mathsf{u}()$ simply as $\mathsf{u}$, and to
  use infix an infix operator~$\cdot$ in place of~$\mathsf{m}$. With such notation the
  above equation would be written as
  %
  \begin{equation*}
    x, y \mid y \cdot x = (\mathsf{u} \cdot x) \cdot y.
  \end{equation*}
  %
  One might even omit $\cdot$ and the context, in which case the equation is written
  simply as $y \, x = (\mathsf{u} \, x) \, y$. If we agree that $\cdot$ associates to the
  left then $(\mathsf{u} \, x) \, y$ may be written as $\mathsf{u} \, x \, y$, and we are
  left with $y \, x = \mathsf{u} \, x \, y$. Note that we are \emph{not} discussing
  validity of equations but only methods for writing them down. It is irrelevant whether
  the above equation is valid in monoids.
\end{example}


\subsection{Algebraic theories}
\label{sec:algebraic-theories-1}

An \emph{algebraic theory} is given by a signature~$\Sigma$ and a collection of
$\Sigma$-equations in contexts.
%
We impose no restrictions on the number of operation symbols or equations, but at least in
classical treatments of the subject certain complications are avoided by insisting that
arities be non-negative integers.

\begin{example}
  \label{ex:theory-group}
  %
  The theory of a group is algebraic. In order to follow closely the definitions we eschew
  the traditional notation $\cdot$ and ${}^{-1}$, and explicitly display the contexts. We
  abide by such formalistic requirements once to demonstrate them, but shall take
  notational liberties subsequently.
  %
  The signature for the theory of a group is given by operation symbols $\mathsf{u}$,
  $\mathsf{m}$, and $\mathsf{i}$ whose arities are $0$, $2$, and $1$, respectively. The
  equations are:
  %
  \begin{align*}
    x, y, z &\mid \mathsf{m}(\mathsf{m}(x, y), z) = \mathsf{m}(x, \mathsf{m}(y, z)),\\
    x &\mid \mathsf{m}(\mathsf{u}(), x) = x \\
    x &\mid \mathsf{m}(x_0, \mathsf{u}()) = x,\\
    x &\mid \mathsf{m}(x, \mathsf{i}(x)) = \mathsf{u}()\\
    x &\mid \mathsf{m}(\mathsf{i}(x), x) = \mathsf{u}().
  \end{align*}
  %
\end{example}

\begin{example}
  \label{ex:semi-lattice}
  %
  The theory of a semi-lattice is algebraic. It is given by a nullary symbol $\bot$ and a
  binary symbol $\vee$, satisfying the equations
  %
  \begin{align*}
    x \vee (y \vee z) &= (x \vee y) \vee z,\\
    x \vee y &= y \vee x,\\
    x \vee x &= x,\\
    x \vee \bot &= x.
  \end{align*}
  %
  It should be clear that the first equation appears in context $x, y, z$, the second one
  in~$x, y$, and the last two in~$x$.
\end{example}

\begin{example}
  \label{ex:field}
  %
  The theory of a field, as usually given, is not algebraic because the inverse~$0^{-1}$
  is undefined, whereas the operations of an algebraic theory are always taken to be
  total. However, a proof is required to show that there is no equivalent algebraic theory.
\end{example}

\begin{example}
  \label{ex:pointed-set}
  %
  The theory of a \emph{pointed set} has a constant $\star$ and no equations.
\end{example}

\begin{example}
  \label{ex:theory-empty}
  %
  The \emph{empty theory} has no operation symbols and no equations.
\end{example}

\begin{example}
  \label{ex:theory-singleton}
  %
  The theory of a \emph{singleton} has a constant $\star$ and the equation $x = y$.
\end{example}

\begin{example}
  \label{ex:lattice}
  %
  A bounded lattice is a partial order with finite infima and suprema. Such a formulation
  is not algebraic because the infimum and supremum operators do not have fixed arities,
  but we can reformulate it in terms of nullary and binary operations.
  Thus, the theory of a bounded lattice has constants $\bot$ and $\top$, and two binary
  operation symbols $\vee$ and $\wedge$, satisfying the equations:
  %
  \begin{align*}
    x \vee (y \vee z) &= (x \vee y) \vee z,   &      x \wedge (y \wedge z) &= (x \wedge y) \wedge z,\\
    x \vee y &= y \vee x,                     &      x \wedge y &= y \wedge x,\\
    x \vee x &= x,                            &      x \wedge x &= x,\\
    x \vee \bot &= x,                         &      x \wedge \top &= x.
  \end{align*}
  %
  Notice that the theory of a bounded lattice is simply the juxtaposition of two copies of
  the theory of a semi-lattice from Example~\ref{ex:semi-lattice}. The partial order is
  recovered because $x \leq y$ is equivalent to $x \vee y = y$ and to $x \wedge y = x$.
\end{example}

\begin{example}
  \label{ex:finitely-generated-group}
  %
  A \emph{finitely generated group} is a group which contains a finite collection of
  elements, called the \emph{generators}, such that every element of the group is obtained
  by multiplications and inverses of the generators. It is not clear how to express this
  condition using only equations, but a proof is required to show that there is no
  equivalent algebraic theory.
\end{example}

\begin{example}
  \label{ex:Cinfty-theory}
  %
  An example of an algebraic theory with many operations and equations is the theory of a
  $\Cinfty$-ring. Let $\Cinfty(\RR^n, \RR^m)$ be the set of all smooth maps from $\RR^n$
  to $\RR^m$. The signature for the theory of a $\Cinfty$-ring contains an $n$-ary
  operation symbol $\op_f$ for each $f \in \Cinfty(\RR^n, \RR)$. For all
  $f \in \Cinfty(\RR^n, \RR)$, $h \in \Cinfty(\RR^m, \RR)$, and
  $g_1, \ldots, g_n \in \Cinfty(\RR^m, \RR)$ such that
  %
  \begin{equation*}
    f \circ (g_1, \ldots, g_n) = h,
  \end{equation*}
  %
  the theory has the equation
  %
  \begin{equation*}
    x_1, \ldots, x_m \mid
    \op_f (\op_{g_1}(x_1, \ldots, x_m), \ldots, \op_{g_n}(x_1, \ldots, x_m)) =
    \op_h(x_1, \ldots, x_m).
  \end{equation*}
  %
  The theory contains as a subtheory the theory of a commutative ring with unit. Indeed,
  addition, multiplication and subtraction of real numbers are smooth operations, and so
  they appear as $\op_{+}$, $\op_{\times}$, $\op_{-}$, and so do constants $\op_0$ and
  $\op_1$ (all maps $\RR^0 \to \RR$ are smooth). The commutative ring equations are
  present as well because the real numbers form a commutative ring.
\end{example}


\subsection{Interpretations of signatures}
\label{sec:interp-of-sign}

Let a signature $\Sigma$ be given. An \emph{interpretation~$I$} of $\Sigma$ is given by
the following data:
%
\begin{enumerate}
\item a set $|I|$, called the \emph{carrier},
\item for each operation symbol $\op_i$ of arity $n_i$ a map
  %
  \begin{equation*}
    \sem{\op_i}_I : \underbrace{|I| \times \cdots \times |I|}_{n_i} \to |I|.
  \end{equation*}
\end{enumerate}
%
The double bracket $\sem{{\ }}_I$ is called the \emph{semantic bracket} and is typically
used when syntactic entities (operation symbols, terms, equations) are mapped by~$I$ to
their mathematical counterparts. When no confusion can arise, we omit the subscript~$I$
and write just~$\sem{{\ }}$.

We abbreviate an $n$-ary product $|I| \times \cdots \times |I|$ as $|I|^n$. A nullary product
$|I|^0$ is the singleton set~$\one = \{\star\}$, which matches our expectation that a
nullary operation symbol be interpreted by an element of~$|I|$. Indeed, the elements of $|I|$
are in bijective correspondence with maps $\one \to |I|$.

An interpretation~$I$ may be extended to $\Sigma$-terms. A $\Sigma$-term in context
%
\begin{equation*}
  x_0, \ldots, x_{k-1} \mid t
\end{equation*}
%
is interpreted by a map
%
\begin{equation*}
  \sem{x_0, \ldots, x_{k-1} \mid t}_I : |I|^k \to |I|,
\end{equation*}
%
as follows:
%
\begin{enumerate}
\item the variable $x_i$ is interpreted as the $i$-th projection,
  %
  \begin{equation*}
    \sem{x_0, \ldots, x_{k-1} \mid  x_i}_I = \pi_i : |I|^k \to |I|,
  \end{equation*}
\item a compound term in context
  %
  \begin{equation*}
    x_0, \ldots, x_{k-1} \mid \op_i(t_1, \ldots, t_{n_i})
  \end{equation*}
  %
  is interpreted as the composition of maps
  %
  \begin{equation*}
    \xymatrix@+6em{
      {|I|^k} \ar[r]^{(\sem{t_0}_I, \ldots, \sem{t_{n_i}}_I)}
      &
      {|I|^{n_i}} \ar[r]^{\sem{\op_i}_I}
      &
      {|I|}
    }
  \end{equation*}
  %
  where we elided the contexts $x_0, \ldots, x_{k-1}$ for the sake of brevity.
\end{enumerate}

\begin{example}
  One interpretation of the signature from Example~\ref{ex:monoid-signature} is given by
  the carrier set $\RR$ and the interpretations of operation symbols
  %
  \begin{align*}
    \sem{\mathsf{u}}() &= 1 + \sqrt{5}, \\
    \sem{\mathsf{m}}(a, b) &= a^2 + b^3.
  \end{align*}
  %
  The term in context $x, y \mid \mathsf{m}(\mathsf{u}, \mathsf{m}(x, x))$ is interpreted
  as the map $\RR \to \RR$, given by the rule
  %
  \begin{equation*}
    (a, b) \mapsto (a+1)^3 a^6 + 2 (3 + \sqrt{5}).
  \end{equation*}
  %
  The same term in a context $y, x, z$ is interpreted as the map $\RR \times \RR \to \RR$,
  given by the rule
  %
  \begin{align*}
    (a, b, c) &\mapsto (b+1)^3 b^6 + 2 (3 + \sqrt{5}).
  \end{align*}
  %
  These are not the same map, as they do not even have the same domains! It is irrelevant
  whether this interpretation satisfies the monoid laws because we have not considered any
  equations yet.
\end{example}

The previous examples shows why contexts should not be ignored. In mathematical practice
contexts are often relegated to guesswork for the reader, or are handled implicitly. For
example, in real algebraic geometry the solution set of the equation $x^2 + y^2 = 1$ is
either a unit circle in the plane or an infinitely extending cylinder of unit radius in
the space, depending on whether the context might be $x, y$ or $x, y, z$. Which context is
meant is indicated one way or another by the author of the mathematical text.

\subsection{Models of algebraic theories}
\label{sec:models-algebr-theor}

A \emph{model~$M$} of an algebraic theory is an interpretation of the signature which
validates all the equations of the theory. That is, for every equation
%
\begin{equation*}
  x_1, \ldots, x_k \mid \ell = r
\end{equation*}
%
of the theory, the maps
%
\begin{equation*}
  \sem{x_1, \ldots, x_k \mid \ell}_M : |M|^k \to |M|
  \qquad\text{and}\qquad
  \sem{x_1, \ldots, x_k \mid r}_M : |M|^k \to |M|
\end{equation*}
%
are equal.

\begin{example}
  A model of the theory of a group from Example~\ref{ex:theory-group} is given by a
  carrier set $G$ and maps
  %
  \begin{equation*}
    u : \one \to G,\qquad
    m : G \times G \to G,\qquad
    i : G \to G,
  \end{equation*}
  %
  interpreting the operation symbols $\mathsf{u}$, $\mathsf{m}$, and $\mathsf{i}$,
  respectively, such that the equations listed in the example are valid. This amounts
  precisely to $(G, u, m, i)$ being a group, except that the unit $u$ is viewed as a map
  $\one \to G$ instead of an element of~$G$.
\end{example}

\begin{example}
  Every algebraic theory has the \emph{trivial model}, whose carrier is the
  singleton~$\one$, and whose operations are interpreted by the unique maps
  $\one^k \to \one$. All equations are satisfied because any two maps $\one^k \to \one$
  are equal.
\end{example}

The previous example explains why one should \emph{not} require $0 \neq 1$ in a ring, as
that prevents the theory of a ring from being algebraic.

\begin{example}
  The empty set is a model of the theory if, and only if, the signature has no constants.
\end{example}

\begin{example}
  A model of the theory of a pointed set from Example~\ref{ex:pointed-set} is a set $S$
  and a chosen element $s \in S$, which interprets the constant $\star$.
\end{example}

\begin{example}
  A model of the empty theory from Example~\ref{ex:theory-empty} is the same thing as a
  set.
\end{example}

\begin{example}
  A model of the theory of the singleton from Example~\ref{ex:theory-singleton} is any
  set with precisely one element.
\end{example}

Suppose $L$ and $M$ are models of a given theory. Then we may form the \emph{product of
  models} $L \times M$ by taking the cartesian product as the carrier,
%
\begin{equation*}
  |L \times M| = |L| \times |M|,
\end{equation*}
%
and pointwise operations,
%
\begin{equation*}
  \sem{\op_i}_{M \times L}(a, b) = (\sem{\op_i}_M(a), \sem{\op_i}_L(a)).
\end{equation*}
%
The equations of the theory are valid in $L \times M$ because they are valid on each
coordinate. This construction can be extended to a product of any number of models,
including an infinite one.

\begin{example}
  We may now prove that the theory of a field from Example~\ref{ex:field} is not
  equivalent to an algebraic theory. There are fields of size 2 and 3, namely $\ZZ_2$ and
  $\ZZ_3$. If there were an algebraic theory of a field, then $\ZZ_2 \times \ZZ_3$ would
  be a field too, but it is not, and in fact there is no field of size~6.
\end{example}

\begin{example}
  Similarly, the theory of a finitely generated group cannot be formulated as an algebraic
  theory, because an infinite product of non-trivial finitely generated groups is not
  finitely generated.
\end{example}

\begin{example}
  Let us give a model of the theory of a $\Cinfty$-ring from
  Example~\ref{ex:Cinfty-theory}. Pick a smooth manifold~$M$, and let the carrier be the
  set $\Cinfty(M, \RR)$ of all smooth scalar fields on~$M$. Given
  $f \in \Cinfty(\RR^n, \RR)$, interpret the operation $\op_f$ as the map
  %
  \begin{align*}
    \sem{\op_f} &: \Cinfty(M, \RR)^n \to \Cinfty(M, \RR) \\
    \sem{\op_f} &: (u_1, \ldots, u_n) \mapsto f \circ (u_1, \ldots, u_n).
  \end{align*}
  %
  We leave it as an exercise to verify that all equations are validated by this
  interpretation.
\end{example}


\subsection{Variations}
\label{sec:variations}

\subsubsection{Operations with parameters}
\label{sec:oper-with-param}

\subsubsection{Arbitrary arities}
\label{sec:arbitrary-arities}

\subsubsection{Multi-sorted algebraic theories}
\label{sec:multi-sort-algebr}


\section{Computational effects as algebraic operations}
\label{sec:comp-effects-as}

\section{Algebraic handlers}
\label{sec:algebraic-handlers}



\end{document}
